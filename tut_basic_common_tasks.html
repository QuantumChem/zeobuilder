
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.3. Common tasks &mdash; Zeobuilder v0.0 documentation</title>
    <link rel="stylesheet" href="static/default.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '0.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="Zeobuilder v0.0 documentation" href="index.html" />
    <link rel="up" title="4. Zeobuilder Tutorial – Getting started" href="tut_basic.html" />
    <link rel="next" title="4.4. Measurements" href="tut_basic_measurements.html" />
    <link rel="prev" title="4.2. Getting started" href="tut_basic_getting_started.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tut_basic_measurements.html" title="4.4. Measurements"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tut_basic_getting_started.html" title="4.2. Getting started"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Zeobuilder v0.0 documentation</a> &raquo;</li>
          <li><a href="tut_basic.html" accesskey="U">4. Zeobuilder Tutorial &#8211; Getting started</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="common-tasks">
<h1>4.3. Common tasks<a class="headerlink" href="#common-tasks" title="Permalink to this headline">¶</a></h1>
<p>In this chapter, we use a model of dipropylether
(<a href="downloads/dipropylether.xyz"><strong class="xref">dipropylether.xyz</strong></a>),
Silicalite-1
(<a href="downloads/silicalite1.zml"><strong class="xref">silicalite1.zml</strong></a>),
THF
(<a href="downloads/thf.xyz"><strong class="xref">thf.xyz</strong></a>),
and an MFI precursor model
(<a href="downloads/precursor.zml"><strong class="xref">precursor.zml</strong></a>).</p>
<div class="section" id="adding-bonds-to-the-model">
<h2>4.3.1. Adding bonds to the model<a class="headerlink" href="#adding-bonds-to-the-model" title="Permalink to this headline">¶</a></h2>
<p>Load the file <a href="downloads/dipropylether.xyz"><strong class="xref">dipropylether.xyz</strong></a>. Your
window should be similar to figure the figure below. Zeobuilder only shows the atoms and no
bonds because the XYZ format only contains atomic coordinates. One can easily add
bonds automatically based on a database of average bond lengths in two steps:}}</p>
<div align="center" class="figure">
<img alt="images/zeobuilder_dipropylether.png" src="_images/zeobuilder_dipropylether.png" />
<p class="caption">Zeobuilder with dipropylether.xyz</p>
</div>
<ol class="arabic simple">
<li>Select the global reference frame. The easiest way to accomplish this, is by
clicking on the first node in the tree view.</li>
<li>Activate the function <tt class="docutils literal"><span class="pre">Object</span> <span class="pre">-&gt;</span> <span class="pre">Molecular</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">bonds</span> <span class="pre">(database)</span></tt> or
press <tt class="docutils literal"><span class="pre">Ctrl-B</span></tt>.</li>
</ol>
<p>Zeobuilder always selects newly created objects after any operation. In this
case all the bonds are selected.</p>
<p>One might wonder why bonds are explicit objects in Zeobuilder. At first sight it
seems much simpler to draw them always automatically in the 3D view, without
listing them in the tree view. These are the reasons to choose for explicit bond
objects in Zeobuilder:</p>
<ul class="simple">
<li>The &#8216;automatic&#8217; approach implies that the internal list of bonds has to be
updated automatically each time one or more atoms are displaced. For small
models (&lt;100 atoms), this is OK, but for very large models (&gt;1000 atoms), this
becomes a CPU-consuming process and it will kill the responsiveness of the
program.</li>
<li>When preparing a model for a molecular mechanics simulation, the bond graph is
also an explicit part of the input. It is therefore useful to offer the
possibility to add or remove bonds manually.</li>
<li>In some applications, bonds are used to display the topology of the structure
at a slightly larger scale. When visualizing Zeolite models, this is a common
practice. In the figure below, the oxygen atoms are omitted and the neighboring
silicon atoms are connected by bond objects. This has been accomplished with
the menu function <tt class="docutils literal"><span class="pre">Object</span> <span class="pre">-&gt;</span> <span class="pre">Molecular</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">bonds</span> <span class="pre">(parameters)</span></tt>. Try
this, starting from the original MFI model (<a href="downloads/silicalite1.zml"><strong class="xref">silicalite1.zml</strong></a>). The mfi model is based on the data from the
<a class="reference external" href="http://www.iza-structure.org/databases/">Zeolite atlas</a>.</li>
</ul>
<div align="center" class="figure">
<img alt="images/mfi_abstract.png" src="_images/mfi_abstract.png" />
</div>
</div>
<div class="section" id="internal-rotations">
<h2>4.3.2. Internal rotations<a class="headerlink" href="#internal-rotations" title="Permalink to this headline">¶</a></h2>
<p>In this section we will demonstrate how the hierarchical data structure of
Zeobuilder proofs to be helpful when performing internal rotations in a
molecule. Open the model <a href="downloads/dipropylether.xyz"><strong class="xref">dipropylether.xyz</strong></a> in Zeobuilder and
add the bonds as explained in the previous section. Two types of internal
rotations will be demonstrated.</p>
<p>The first example is a rotation of a methyl top. Take the following steps:</p>
<ol class="arabic simple">
<li>Chose one of the two methyl groups in the molecule and select all atoms and
bonds of the methyl group. These kind of selections are easily made in the 3D
view by drawing a rectangle around the methyl group. Be careful not to
select other parts of the molecule by accident. One can work with the middle
and right mouse buttons to tune the selection.</li>
<li>Activate the function <tt class="docutils literal"><span class="pre">Object</span> <span class="pre">-&gt;</span> <span class="pre">Arrange</span> <span class="pre">-&gt;</span> <span class="pre">Frame</span></tt> or press <tt class="docutils literal"><span class="pre">Ctrl-F</span></tt>.
Inspect the result in the tree view: The methyl group now lives in its proper
reference frame.</li>
<li>Select the reference frame that contains the methyl group (in the tree view).
Your window should look like this figure:</li>
</ol>
<div align="center" class="figure">
<img alt="images/zeobuilder_internal_rotation1.png" src="_images/zeobuilder_internal_rotation1.png" />
<p class="caption">The methyl group in its proper reference frame.</p>
</div>
<ol class="arabic simple" start="4">
<li>Add the methyl-C bond to the current selection, i.e. click on this bond with
the middle mouse button in the 3D view.</li>
<li>Use the interactive rotate function, i.e. drag with the left mouse button
while holding the <tt class="docutils literal"><span class="pre">Ctrl</span></tt> key pressed. (Make sure the <tt class="docutils literal"><span class="pre">Ctrl</span></tt> key is pressed
before you start dragging.) You will notice that the methyl group rotates
about the C-C axis. You should get something similar to the following figure:</li>
</ol>
<div align="center" class="figure">
<img alt="images/zeobuilder_internal_rotation1_done.png" src="_images/zeobuilder_internal_rotation1_done.png" />
<p class="caption">The methyl group after rotation.</p>
</div>
<ol class="arabic simple" start="6">
<li>Select the methyl frame again in the tree view and activate the menu function
<tt class="docutils literal"><span class="pre">Object</span> <span class="pre">-&gt;</span> <span class="pre">Arrange</span> <span class="pre">-&gt;</span> <span class="pre">Unframe</span> <span class="pre">(absolute)</span></tt> or press <tt class="docutils literal"><span class="pre">Ctrl-Shift-F</span></tt>. The</li>
</ol>
<p>The second example is a rotation that changes the C-O-C bending angle. Follow
these instructions:</p>
<ol class="arabic simple">
<li>Select a complete propyl chain. Perform this selection in the 3D view.</li>
<li>Activate the function <tt class="docutils literal"><span class="pre">Object</span> <span class="pre">-&gt;</span> <span class="pre">Arrange</span> <span class="pre">-&gt;</span> <span class="pre">Frame</span></tt> or press <tt class="docutils literal"><span class="pre">Ctrl-F</span></tt>.</li>
<li>Select the frame that contains the propyl group. Make sure only the frame is
selected and not its contents.</li>
<li>Add the oxygen atom to the selection by clicking on it the the 3D view with
the middle mouse button.</li>
<li>Start an interactive rotation by dragging in the 3D view while holding the
<tt class="docutils literal"><span class="pre">Ctrl</span></tt> key pressed. You will see that the oxygen atom acts as a rotation
center.</li>
<li>When finished, select only the reference frame of the propyl group and
activate the menu function <tt class="docutils literal"><span class="pre">Object</span> <span class="pre">-&gt;</span> <span class="pre">Arrange</span> <span class="pre">-&gt;</span> <span class="pre">Unframe</span> <span class="pre">(absolute)</span></tt> or
press <tt class="docutils literal"><span class="pre">Ctrl-Shift-F</span></tt>.</li>
</ol>
</div>
<div class="section" id="pseudo-rotations">
<h2>4.3.3. Pseudo rotations<a class="headerlink" href="#pseudo-rotations" title="Permalink to this headline">¶</a></h2>
<p>Although the rotations in the previous section are rather trivial and probably
supported in many similar programs (?), this section describes more complex
cases that demonstrate the advantage of having multiple reference frames. To
keep this example a simple as possible, we will work with a THF model
(<a href="downloads/thf.xyz"><strong class="xref">thf.xyz</strong></a>). Proceed along the following lines:</p>
<ol class="arabic">
<li><p class="first">Load <a href="downloads/thf.xyz"><strong class="xref">thf.xyz</strong></a> and add the bonds.</p>
</li>
<li><dl class="first docutils">
<dt>Select the two carbon atoms next to the oxygen atom. Activate the function</dt>
<dd><p class="first last"><tt class="docutils literal"><span class="pre">Object</span> <span class="pre">-&gt;</span> <span class="pre">Connect</span> <span class="pre">-&gt;</span> <span class="pre">Arrow</span></tt>. This is our first rotation axis.</p>
</dd>
</dl>
</li>
<li><p class="first">The second rotation axis is a bit more complex.</p>
<blockquote>
<ol class="loweralpha simple">
<li>First add a box to the center of the reference frame: Select the global
reference frame in the tree view and activate <tt class="docutils literal"><span class="pre">Object</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">-&gt;</span> <span class="pre">Box</span></tt>.</li>
<li>The box is selected. For reasons of clarity, change to box color to
orange via <tt class="docutils literal"><span class="pre">Object</span> <span class="pre">-&gt;</span> <span class="pre">Properties</span></tt> or by pressing Ctrl-E. The color field
is located in the <tt class="docutils literal"><span class="pre">Markup</span></tt> tab page. Click <tt class="docutils literal"><span class="pre">OK</span></tt> when done.</li>
<li>Select both the oxygen atom and the orange box.</li>
<li>Activate the function <tt class="docutils literal"><span class="pre">Object</span> <span class="pre">-&gt;</span> <span class="pre">Connect</span> <span class="pre">-&gt;</span> <span class="pre">Arrow</span></tt>. This is our second
rotation axis.</li>
</ol>
</blockquote>
</li>
<li><p class="first">Next we will put the part of the molecule we want to rotate in a separate
reference frame. Therefore select the oxygen atom, the neighboring carbon
atoms, the hydrogen atoms connected to these carbon atoms, and the bonds
between them. Press <tt class="docutils literal"><span class="pre">Ctfl-F</span></tt> to create the new reference frame.</p>
</li>
</ol>
<p>At this point your model should be similar to this figure:</p>
<div align="center" class="figure">
<img alt="images/zeobuilder_pseudo_rotation1.png" src="_images/zeobuilder_pseudo_rotation1.png" />
<p class="caption">THF, an orange box and two rotation axes.</p>
</div>
<p>Now we are ready to make two types of rotations:</p>
<ol class="lowerroman simple">
<li>Select the new reference frame and the first rotation axis. Perform an
interactive rotation. This type of rotation brings the THF molecule in the
envelope conformation.</li>
<li>Select the new reference frame and the second rotation axis. Perform an
interactive rotation. Such a rotation changes to geometry into the twist
conformation.</li>
</ol>
<p>One can save the new geometries to different XYZ files and run geometry
optimizations to see if such conformers are stable.</p>
<p>From this example it should be clear that Zeobuilder is capable of performing
any kind of rotation. One can freely define the rotation axis and the part of
the molecule that needs to be rotated. Creativity is the last ingredient to get
the work done.</p>
</div>
<div class="section" id="advanced-selections">
<h2>4.3.4. Advanced selections<a class="headerlink" href="#advanced-selections" title="Permalink to this headline">¶</a></h2>
<p>When working with large models, manually selecting a specific set of atoms (or
other objects) quickly becomes an intractable task. Zeobuilder can automatically
make complex selections based on filter expressions to surmount this potential
difficulty. Load the model <a href="downloads/precursor.zml"><strong class="xref">precursor.zml</strong></a>.
Select the global reference frame and activate the menu function <tt class="docutils literal"><span class="pre">Select</span> <span class="pre">-&gt;</span>
<span class="pre">Children</span> <span class="pre">by</span> <span class="pre">expression</span></tt>. A popup dialog will appear that looks similar to figure
A3.6. One can enter a valid python expression in the big (white) text entry that
will be applied to all child nodes of the selected container object. In this
example, the selected container is the global reference frame. If the expression
evaluates to True, the child node is selected, otherwise, the child is not
selected. Here are a few expressions to get you started:</p>
<ul class="simple">
<li><strong>All atoms:</strong> <tt class="docutils literal"><span class="pre">isinstance(node,</span> <span class="pre">Atom)</span></tt></li>
<li><strong>All bonds:</strong> <tt class="docutils literal"><span class="pre">isinstance(node,</span> <span class="pre">Bond)</span></tt></li>
<li><strong>All hydrogen atoms:</strong> <cite>isinstance(node, Atom) and node.number == 1`</cite></li>
<li><strong>All atoms connected to one or more hydrogen atoms:</strong> <tt class="docutils literal"><span class="pre">isinstance(node,</span>
<span class="pre">Atom)</span> <span class="pre">and</span> <span class="pre">reduce(lambda</span> <span class="pre">x,y:</span> <span class="pre">x</span> <span class="pre">or</span> <span class="pre">y,</span> <span class="pre">(neighbor.number</span> <span class="pre">==</span> <span class="pre">1</span> <span class="pre">for</span> <span class="pre">neighbor</span> <span class="pre">in</span>
<span class="pre">node.yield_neighbors()),</span> <span class="pre">False)</span></tt></li>
</ul>
<p>The expressions in Zeobuilder are ordinary python expressions. Python evaluates
boolean expressions with the <a class="reference external" href="http://en.wikipedia.org/wiki/Lazy_evaluation">Lazy evaluation</a> technique. This means that for
the evaluations of <cite>X and Y</cite>, expression Y will only be evaluated if X evaluates
to True. This is different from low level languages such as C and Fortran, where
lazy evaluations have to be implemented explicitly with nested if clauses. This
means that the following expression will not work in general:</p>
<ul class="simple">
<li><strong>All hydrogen atoms (does not work in general):</strong> <tt class="docutils literal"><span class="pre">node.number</span> <span class="pre">==</span> <span class="pre">1</span> <span class="pre">and</span> <span class="pre">isinstance(node,</span> <span class="pre">Atom)</span></tt></li>
</ul>
<p>For example, when the selected frame also contains bond objects, which don&#8217;t
have a <tt class="docutils literal"><span class="pre">number</span></tt> attribute, Zeobuilder will generate an error message when the
former expression is used.</p>
<div align="center" class="figure">
<img alt="images/dialog_select_children_by_expression.png" src="_images/dialog_select_children_by_expression.png" />
<p class="caption">The popup dialog of the menu function <tt class="docutils literal"><span class="pre">Select</span> <span class="pre">-&gt;</span> <span class="pre">Children</span> <span class="pre">by</span> <span class="pre">expression</span></tt></p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <a class="reference external" href="http://en.wikipedia.org/wiki/API">API</a> of the filter expressions is
not settled yet, nor is it extensively documented. There is no guarantee
that these example will work in all future versions of Zeobuilder.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference external" href="#">4.3. Common tasks</a><ul>
<li><a class="reference external" href="#adding-bonds-to-the-model">4.3.1. Adding bonds to the model</a></li>
<li><a class="reference external" href="#internal-rotations">4.3.2. Internal rotations</a></li>
<li><a class="reference external" href="#pseudo-rotations">4.3.3. Pseudo rotations</a></li>
<li><a class="reference external" href="#advanced-selections">4.3.4. Advanced selections</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tut_basic_getting_started.html"
                        title="previous chapter">4.2. Getting started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tut_basic_measurements.html"
                        title="next chapter">4.4. Measurements</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/tut_basic_common_tasks.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tut_basic_measurements.html" title="4.4. Measurements"
             >next</a> |</li>
        <li class="right" >
          <a href="tut_basic_getting_started.html" title="4.2. Getting started"
             >previous</a> |</li>
        <li><a href="index.html">Zeobuilder v0.0 documentation</a> &raquo;</li>
          <li><a href="tut_basic.html" >4. Zeobuilder Tutorial &#8211; Getting started</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Toon Verstraelen.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.
    </div>
  </body>
</html>